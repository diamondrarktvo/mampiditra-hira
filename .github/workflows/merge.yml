# il y a une autre syntaxe meilleur que celui ci en utilisant '/release/*' comme branche du coup on ne spÃ©cifie plus from_branch
name: Merge branch CD
run-name: ${{ github.actor }} ->  ${{ github.event.head_commit.message }}
env: 
  CURRENT_BRANCH: ${{ github.ref_name }}
on:
  push:
    branches:
      - 'dama'
      - 'mihary'
      - 'tino'
jobs:
  merge-branch-develop:
    name: Merge local
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master

      - name: Merge branch ${{ env.CURRENT_BRANCH }} to develop
        uses: devmasx/merge-branch@1.4.0

        with:
          type: now
          from_branch: ${{ env.CURRENT_BRANCH }}
          target_branch: develop
          github_token: ${{ secrets.GITHUB_TOKEN }}

  copy-file:
    needs: merge-branch-develop
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2

    # Copy the 'front' folder
    - name: Push posts
      uses: dmnemec/copy_file_to_another_repo_action@main
      env:
        API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
      with:
        source_file: 'front/' # Folder to copy
        destination_repo: 'https://github.com/diamondrarktvo/mp3-downloader-prod.git' # Target repo
        destination_folder: 'front/' # Folder where to copy it
        user_email: 'amada.rktvo@gmail.com'
        user_name: 'diamondrarktvo'
        commit_message: "AUTO: Copying front from develop to preprod"
        git_server: 'github.com'
        

